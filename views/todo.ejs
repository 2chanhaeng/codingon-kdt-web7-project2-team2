<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <div class="main">
      <h1>투두리스트 초안</h1>
      <form id="todoForm" action="#" method="post">
        <input type="text" placeholder="새로운 할 일" name="todo" required />
        <button type="submit"><b>추가</b></button>
      </form>
      <div class="todolist">
        <ul></ul>
        <a id="clear">모두 삭제</a>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      init();

      function init() {
        document.getElementById("todoForm").addEventListener("submit", addToDo);
        document.getElementById("clear").addEventListener("click", clearTodoList);
        document.querySelector("ul").addEventListener("click", deleteOrCheck);
      }

      function deleteOrCheck(e) {
        if (e.target.className == "delete") deleteToDo(e);
        else {
          checkToDo(e);
        }
      }

      function deleteToDo(e) {
        let remove = e.target.parentNode;
        let parentNode = remove.parentNode;
        parentNode.removeChild(remove);
      }

      function checkToDo(e) {
        const todo = e.target.nextSibling;
        if (e.target.checked) {
          todo.style.color = "#dddddd";
        } else {
          todo.style.color = "#000000";
        }
      }

      function clearTodoList(e) {
        let ul = document.querySelector("ul");
        ul.innerHTML = "";
      }

      function addToDo(e) {
        e.preventDefault();
        let toDoValue = document.querySelector("input");
        if (toDoValue.value !== "") {
          addTask(toDoValue.value);
          saveTask(toDoValue.value); // 투두리스트를 서버에 저장
        }
        toDoValue.value = "";
      }

      function addTask(value) {
        let ul = document.querySelector("ul");
        let li = document.createElement("li");
        li.innerHTML = `<span class="delete">x</span><input type="checkbox"><label>${value}</label>`;
        ul.appendChild(li);
        document.querySelector(".todolist").style.display = "block";
      }

      function saveTask(value) {
        axios({
          method: "POST",
          url: "/todo", // 서버의 저장 경로에 맞게 수정해야 합니다.
          data: {
            task: value,
          },
        })
          .then((response) => {
            console.log("투두리스트가 성공적으로 저장되었습니다.");
          })
          .catch((error) => {
            console.error("투두리스트 저장 중 오류가 발생했습니다.", error);
          });
      }
    </script>
  </body>
</html>
